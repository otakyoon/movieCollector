<!DOCTYPE html>
<html lang="fr-">
<head>
    <script src="data.js"></script>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="styles.css" rel="stylesheet">
    <style>
        body {
            background-color: #f0f0f0; /* Couleur de fond claire */
            color: #cccccc; /* Couleur de texte claire */
        }
        .navbar {
            background-color: #e0e0e0; /* Couleur de fond claire pour la barre de navigation */
        }
        .navbar-nav .nav-link {
            color: #d3d3d3; /* Couleur de texte claire pour les liens de navigation */
        }
        .drop-zone {
            border: 2px dashed #d3d3d3; /* Couleur de bordure claire */
            padding: 20px;
            text-align: center;
            margin-top: 20px;
            width:200px;
            margin-left: auto;
            margin-right: auto;
        }
        .movie-item {
            cursor: grab;
        }
        .modal-content {
            background-color: #f9f9f9; /* Couleur de fond claire pour les modals */
        }
        .modal-header, .modal-footer {
            border-color: #ececec; /* Couleur de bordure claire */
        }
        footer {
            background-color: #e0e0e0; /* Couleur de fond claire pour le pied de page */
        }
        .btn-primary, .btn-secondary {
            background-color: #4175fa; /* Couleur de fond claire pour les boutons */
            border-color: #d3d3d3; /* Couleur de bordure claire */
            color: #9b99db; /* Couleur de texte claire */
        }
        .btn-primary:hover, .btn-secondary:hover {
            background-color: #d3d3d3; /* Couleur de fond légèrement plus foncée au survol */
            border-color: #cccccc; /* Couleur de bordure légèrement plus foncée au survol */
            color: #e0e0e0; /* Couleur de texte légèrement plus foncée au survol */
        }
    </style>
</head>
<body>
    <header>
        <h1>Catalogue de Films</h1>
        <img src = "./titre.png" alt = "description de l'image" width="80%">    
    </header>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container">
            <a class="navbar-brand" href="index.html">Accueil</a>
            <div class="collapse navbar-collapse">
                <ul class="navbar-nav mr-auto">
                    <li class="nav-item"><a class="nav-link" href="catalogue.html">Catalogue</a></li>
                    <li class="nav-item"><a class="nav-link" href="critiques.html">Critiques</a></li>
                    <li class="nav-item"><a class="nav-link" href="collection.html">Ma Collection</a></li>
                    <li class="nav-item"><a class="nav-link" href="ajouter.html">Ajouter un Film</a></li>
                    <li class="nav-item"><a class="nav-link" href="profil.html">Profil</a></li>
                    <li class="nav-item"><a class="nav-link" href="aide.html">Aide</a></li>
                </ul>
                <ul class="navbar-nav ml-auto" id="auth-buttons">
                    <li class="nav-item"><a class="nav-link" href="login.html">Connexion</a></li>
                    <li class="nav-item"><a class="nav-link" href="register.html">Créer un Compte</a></li>
                </ul>
            </div>
        </div>
    </nav>
    <div class="content container">
        <div class="drop-zone" id="dropZone">
            <p>ajouter à votre collection</p>
        </div>
        <h2>Liste des Films</h2>
        <div class="row" id="movie-list">
            <!-- Films seront ajoutés ici par JavaScript -->
        </div>
    </div>

    <!-- Modal de Confirmation -->
    <div class="modal fade" id="confirmModal" tabindex="-1" aria-labelledby="confirmModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirmModalLabel">Confirmer l'ajout</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    Voulez-vous vraiment faire cela ?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-dismiss="modal">Annuler</button>
                    <button type="button" class="btn btn-secondary" id="confirmAddButton">Suivant</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Connexion -->
    <div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="loginModalLabel">Connexion Requise</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    Vous devez être connecté pour ajouter un film à votre collection.
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-dismiss="modal">OK</button>
                </div>
            </div>
        </div>
    </div>

    <footer class="bg-light py-3">
        <div class="container">
            <div class="row">
                <div class="col-md-4">
                    <h5>Informations Légales</h5>
                    <ul class="list-unstyled">
                        <li><a href="mentions-legales.html">Mentions Légales</a></li>
                        <li><a href="politique-confidentialite.html">Politique de Confidentialité</a></li>
                        <li><a href="conditions-utilisation.html">Conditions d'Utilisation</a></li>
                    </ul>
                </div>
                <div class="col-md-4">
                    <h5>Plan du Site</h5>
                    <ul class="list-unstyled">
                        <li><a href="index.html">Accueil</a></li>
                        <li><a href="catalogue.html">Catalogue</a></li>
                        <li><a href="collection.html">Ma Collection</a></li>
                        <li><a href="ajouter.html">Ajouter un Film</a></li>
                        <li><a href="critiques.html">Critiques</a></li>
                        <li><a href="profil.html">Profil</a></li>
                        <li><a href="aide.html">Aide</a></li>
                    </ul>
                </div>
                <div class="col-md-4">
                    <p>Liens Utiles</p>
                    <ul class="list-unstyled">
                        <li><a href="https://www.allocine.fr" target="_blank">AlloCiné</a></li>
                        <li><a href="https://www.imdb.com" target="_blank">IMDb</a></li>
                        <li><a href="https://www.rottentomatoes.com" target="_blank">Rotten Tomatoes</a></li>
                    </ul>
                </div>
            </div>
            <div class="text-center mt-3">
                &copy; 2025 Movie Collector
            </div>
        </div>
    </footer>
    <script>
        const apiKey = 'b545d6b8';
        let movieIdToAdd;

        // Simuler l'état de connexion de l'utilisateur
        const isUserLoggedIn = sessionStorage.getItem('isLoggedIn') === 'true';

        // Fonction pour récupérer les données d'un film par recherche
        async function fetchMoviesBySearch(query, page = 1) {
            const response = await fetch(`https://www.omdbapi.com/?s=${query}&page=${page}&apikey=${apiKey}`);
            const data = await response.json();
            return data.Search || [];
        }

        // Afficher tous les films avec images
        async function displayAllMovies() {
            const movieList = document.getElementById('movie-list');
            //let allMovies = [];
            let allMovies = JSON.parse(data) ;
            const totalPages = 20; // Nombre de pages à récupérer pour obtenir environ 50 films

           /* for (let page = 1; page <= totalPages; page++) {
                const movies = await fetchMoviesBySearch('movie', page);
                allMovies = allMovies.concat(movies);
            }*/

            allMovies.forEach(movie => {
                const movieItem = document.createElement('div');
                movieItem.classList.add('col-md-3', 'movie-item');
                movieItem.setAttribute('draggable', true);
                movieItem.setAttribute('data-movie-id', movie.imdbID);
                movieItem.innerHTML = `
                    <img src="${movie.Poster}" class="movie-poster" alt="">
                    <h5>${movie.Title} (${movie.Year})</h5>
                    <div class="btn btn-primary btn-sm" onclick="showConfirmModal('${movie.imdbID}', '${movie.Title}')">Ajouter à ma collection</div>
                    <div rol="buton" class="btn btn-secondary low-contrast btn-sm" onclick="openMovieDetails('${movie.imdbID}')">Voir les détails</div>
                `;
                movieList.appendChild(movieItem);

                // Ajouter les événements de drag and drop
                movieItem.addEventListener('dragstart', dragStart);
            });
        }

        // Afficher le modal de confirmation
        function showConfirmModal(movieId, movieTitle) {
            if (!isUserLoggedIn) {
                $('#loginModal').modal('show');
                return;
            }
            movieIdToAdd = movieId;
            const modalTitle = document.getElementById('confirmModalLabel');
            modalTitle.textContent = `Confirmer cette action pour "${movieTitle}" ?`;
            $('#confirmModal').modal('show');
        }

        // Confirmer l'ajout du film à la collection
        document.getElementById('confirmAddButton').addEventListener('click', function () {
            addToCollection(movieIdToAdd);
            $('#confirmModal').modal('hide');
        });

        // Ajouter un film à la collection
        function addToCollection(movieId) {
            if (!movieId) {
                console.error('ID du film non valide :', movieId);
                return;
            }
            const collection = JSON.parse(sessionStorage.getItem('userCollection')) || [];
            collection.push(movieId);
            sessionStorage.setItem('userCollection', JSON.stringify(collection));
            alert('Film ajouté à votre collection !');
            if (confirm('Voulez-vous voir votre collection ou rester sur la page actuelle ?')) {
                window.location.href = 'collection.html';
            } else {
                window.location.reload();
            }
        }

        // Ouvrir les détails du film dans une nouvelle page
        function openMovieDetails(movieId) {
            window.location.href = `details.html?id=${movieId}`;
        }

        // Fonctions de drag and drop
        function dragStart(event) {
            const movieId = event.currentTarget.getAttribute('data-movie-id');
            if (movieId) {
                event.dataTransfer.setData('text/plain', movieId);
            } else {
                console.error('ID du film non trouvé pour l\'élément :', event.currentTarget);
            }
        }

        const dropZone = document.getElementById('dropZone');
        dropZone.addEventListener('dragover', allowDrop);
        dropZone.addEventListener('drop', drop);

        function allowDrop(event) {
            event.preventDefault();
        }

        function drop(event) {
            event.preventDefault();
            if (!isUserLoggedIn) {
                $('#loginModal').modal('show');
                return;
            }
            const movieId = event.dataTransfer.getData('text');
            addToCollection(movieId);
        }

        displayAllMovies();
    </script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="script.js"></script>
</body>
</html>
